# [Discord RSS Bot, now with whales!](https://github.com/freiheit/discord_feedbot)

![Angry docker avatar](avatars/docker-avatar.png)

Bot for taking in RSS or Atom feeds and sharing them to Discord channels, now stuffed (without grace, mind you) into a tiny container.

## Introduction

This file **is not** intended as an introduction to Discord Feed Bot, nor as an introduction to Docker.
 * If you are unfamiliar with Discord Feed Bot, consult the [ReadMe](README.md).
 * If you are unfamiliar with Docker, check out the [Introduction to Docker](https://training.docker.com/introduction-to-docker) webinar, or consult your favorite search engine.

On the other hand, this file **is** intended to:
 * Take your already operational Discord Feed Bot...
 * And stick it into a ~~shoe box~~ container so that you can ~~hide it under your bed~~ put it on to the back of whale/cargo ship/freight train/lorry, and never worry about it again.

## Build the image

Simply run the following command from the Discord Feed Bot source directory to build your new image
```
docker build -t feedbot .
```

## Simple running command
### Common usage with volume
The file don't need to be called `config.json` but need to be placed in `/config` folder. The file must be in a valid **JSON format**
```
docker run -d -v $(pwd)/config.json:/config/config.json --name=feedbot feedbot
```
### Or using [environnement variables](https://docs.docker.com/engine/reference/run/#env-environment-variables)
```
docker run -d -e CONFIG="$(cat config.json)" --name=feedbot feedbot
```
## Minimal configuration needed 
```
{
    "token": "<TOKEN>",
    "feeds": [
                {
            "channel": "<CHANNEL>",
            "url": "<RSS_FEED_URL>",
        }
    ]
}
```
## Full configuration exemple
```
{
    "token": "OTg1MzgZE3cwNDQyMTF67TU5.GFl0nX.WeyI8vqX3yO6kqh8Oia6cDpgEkZ1zH6eNHN9w8",
    "feeds": [
                {
            "name": "MY-AMAZING-FEED",
            "channel": "984379931012256123",
            "url": "https://www.cert.ssi.gouv.fr/alerte/feed/",
            "fields": "**title**,link,summary"
        },
        {
            "name": "A-BETTER-FEED",
            "channel": "984379931012256123",
            "url": "https://feeds.feedburner.com/TheHackersNews",
            "fields": "**title**,author,_published_,link,summary"
        }
    ],
    "debug": 2,
    "timezone": "utc",
    "publish": 0,
    "gameplayed": "Eating some RSS feeds",
    "skew-min": 1,
    "refresh-time": 1,
    "max-age": 86400,
}
```

## Allow parameter
You can configurate the bot using [environnement variables](https://docs.docker.com/engine/reference/run/#env-environment-variables). 
You can avoid using json config file by simply adding token and feeds through environnement variables
| Command | Explanation | Default value |
|----|----| ----|
| `token` | Your bot token, it's **mandatory** variable. | "" |
| `feeds` | The feeds you want to be used by the bot. Each feeds in the list must be an object with at least a `url`and `channel` set. <ul><li>`name` Name of the feed <li>`url` **mandatory** Url of the feed</li><li>`channel` **mandatory** Channel where to display the feed</li><li>`fields` fields who will be published (default: `**title**,author,_published_,link,summary`)</li>| [] |
| `debug` | Debug mode number. <ul><li>`0` just prints some basic info as thing runs <li>`1` prints debug stuff for this bot</li><li>`2` and above start printing debug stuff for libraries, etc</li><li>`4` and above includes full parsed items, which can be quite verbose... </li> | 2 |
| `timezone` | Your timezone in string  | "utc"
| `publish` | Feature to post on channel followed on multiple server. | 0 |
| `skew-min` | Minimum sleep time at startup, in second | 1 |
| `refresh-time` | Time between refreshes of a feed, in second | 900 |
| `max-age` | Maximum age of a post before it's discarded, in second | 86400 |
| `gameplayed` | Change the game displayed in bot profile | "Eating some RSS feeds" |

You should now (hopefully) notice something similar to this in your discord window:
![phroggbot "Playing with containers"](https://i.imgur.com/lF7kMW0.png)

**Note:** If you've previously run a container named feedbot, this command will fail. In that instance, you can use:
```
docker stop feedbot
```

## Monitor

The Docker model for feedbot will output logging to STDOUT. This means that you can monitor a container's output with: `docker logs feedbot` The value set in your configuration file for debug will determine how much information is output to this log, just as if you were running it manually.
To determine whether feedbot is even running, consult the output from either `docker ps` (to show only running containers) or `docker ps -a` (to show all configured containers).

## Test/Debug

The testing utilities (`show_all_entries.py` and `show_sample_entry.py`) are included inside of the image we [built](#build) earlier. You can access them using the following syntax:
```
docker run --rm feedbot python /opt/show_sample_entry.py https://github.com/freiheit/discord_feedbot/releases.atom
docker run --rm feedbot python /opt/show_all_entries.py https://github.com/freiheit/discord_feedbot/releases.atom
```
